{"remainingRequest":"/Users/xiaoma/Documents/gitlab/web/vuex-4-code/node_modules/babel-loader/lib/index.js!/Users/xiaoma/Documents/gitlab/web/vuex-4-code/node_modules/eslint-loader/index.js??ref--13-0!/Users/xiaoma/Documents/gitlab/web/vuex-4-code/src/vuex/index.js","dependencies":[{"path":"/Users/xiaoma/Documents/gitlab/web/vuex-4-code/src/vuex/index.js","mtime":1624268730617},{"path":"/Users/xiaoma/Documents/gitlab/web/vuex-4-code/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/xiaoma/Documents/gitlab/web/vuex-4-code/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/xiaoma/Documents/gitlab/web/vuex-4-code/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICIvVXNlcnMveGlhb21hL0RvY3VtZW50cy9naXRsYWIvd2ViL3Z1ZXgtNC1jb2RlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiL1VzZXJzL3hpYW9tYS9Eb2N1bWVudHMvZ2l0bGFiL3dlYi92dWV4LTQtY29kZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgX2RlZmluZVByb3BlcnR5IGZyb20gIi9Vc2Vycy94aWFvbWEvRG9jdW1lbnRzL2dpdGxhYi93ZWIvdnVleC00LWNvZGUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2RlZmluZVByb3BlcnR5IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5rZXlzLmpzIjsKaW1wb3J0IHsgaW5qZWN0LCByZWFjdGl2ZSB9IGZyb20gInZ1ZSI7CmV4cG9ydCBmdW5jdGlvbiBmb3JFYWNoVmFsdWUob2JqLCBmbikgewogIE9iamVjdC5rZXlzKG9iaikuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICByZXR1cm4gZm4ob2JqW2tleV0sIGtleSk7CiAgfSk7Cn0gLy8gZm9yRWFjaFZhbHVlKHthOjEsYjoyfSxmdW5jdGlvbih2YWx1ZSwga2V5KXsKLy8gICAgIGNvbnNvbGUubG9nKHZhbHVlLCBrZXkpCi8vIH0pCi8vIOWIm+W7uuWuueWZqCDov5Tlm57kuIDkuKpzdG9yZQoKdmFyIHN0b3JlS2V5ID0gInN0b3JlIjsKCnZhciBTdG9yZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gU3RvcmUob3B0aW9ucykgewogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU3RvcmUpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiY29tbWl0IiwgZnVuY3Rpb24gKHR5cGUsIHBheUxvYWQpIHsKICAgICAgLy8gYmluZHNzcwogICAgICBfdGhpcy5fbXV0YXRpb25zW3R5cGVdKHBheUxvYWQpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJkaXNwYXRjaCIsIGZ1bmN0aW9uICh0eXBlLCBwYXlsb2FkKSB7CiAgICAgIF90aGlzLl9hY3Rpb25zW3R5cGVdKHBheWxvYWQpOwogICAgfSk7CgogICAgY29uc29sZS5sb2cob3B0aW9ucyk7IC8vIHRoaXMuYSA9MTAwOyAKICAgIC8vIHZ1ZTMg5YaF6YOo5Lya5Yib6YCg5LiA5LiqdnVl5a6e5L6L77yM5L2GdnVleDTnm7TmjqXkvJrph4fnlKh2dWUz5o+Q5L6b55qE5ZON5bqU5byP5pa55rOVCiAgICAvLyB0aGlzLnN0YXRlID0gb3B0aW9ucy5zdGF0ZTsKCiAgICB2YXIgc3RvcmUgPSB0aGlzOyAvLyBzdG9yZS5fc3RvcmUuZGF0YSAKCiAgICBzdG9yZS5fc3RhdGUgPSByZWFjdGl2ZSh7CiAgICAgIGRhdGE6IG9wdGlvbnMuc3RhdGUKICAgIH0pOyAvLyBuZXcgVnVlKCkKICAgIC8vIHZ1ZXgg5Lit5pyJ5Liq5q+U6L6D6YeN6KaB55qEQVBJIHJlcGxhY2VTdGF0ZQoKICAgIHZhciBfZ2V0dGVycyA9IG9wdGlvbnMuZ2V0dGVyczsgLy8ge2RvdWJsZTogZnVuY3Rpb24gPT4gZ2V0dGVyfQoKICAgIHN0b3JlLmdldHRlcnMgPSB7fTsKICAgIGZvckVhY2hWYWx1ZShfZ2V0dGVycywgZnVuY3Rpb24gKGZuLCBrZXkpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHN0b3JlLmdldHRlcnMsIGtleSwgewogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIGZuKHN0b3JlLnN0YXRlKTsKICAgICAgICB9IC8vIGNvbXB1dGVkLCDlvojpgZfmhr7vvIzlnKh2dWV45LitdnVlMy4xIOS4jeiDveeUqGNvbXB1dGVkIOWunueOsCDlpoLmnpznu4Tku7bplIDmr4HkuobkvJrnp7vpmaTorqHnrpflsZ7mgKfvvIx2dWUzLjLkvJrmlLnmjonov5nkuKpidWcKCiAgICAgIH0pOwogICAgfSk7IC8vIG11dGF0aW9uIGFjdGlvbiB7YWRkOmZ1bmN0aW9ufSB7YXN5bmNBZGQ6IGZ1bmN0aW9ufQogICAgLy8gY29tbWl0KCJhZGQiKSBkaXNwYXRjaCgiYXN5bmNBZGQiKQoKICAgIHN0b3JlLl9tdXRhdGlvbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgc3RvcmUuX2FjdGlvbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgdmFyIF9tdXRhdGlvbnMgPSBvcHRpb25zLm11dGF0aW9uczsKICAgIHZhciBfYWN0aW9ucyA9IG9wdGlvbnMuYWN0aW9uczsKICAgIGZvckVhY2hWYWx1ZShfbXV0YXRpb25zLCBmdW5jdGlvbiAobXV0YXRpb25zLCBrZXkpIHsKICAgICAgc3RvcmUuX211dGF0aW9uc1trZXldID0gZnVuY3Rpb24gKHBheUxvYWQpIHsKICAgICAgICBtdXRhdGlvbnMuY2FsbChzdG9yZSwgc3RvcmUuc3RhdGUsIHBheUxvYWQpOwogICAgICB9OwogICAgfSk7CiAgICBmb3JFYWNoVmFsdWUoX2FjdGlvbnMsIGZ1bmN0aW9uIChhY3Rpb25zLCBrZXkpIHsKICAgICAgLy8KICAgICAgc3RvcmUuX2FjdGlvbnNba2V5XSA9IGZ1bmN0aW9uIChwYXlMb2FkKSB7CiAgICAgICAgYWN0aW9ucy5jYWxsKHN0b3JlLCBzdG9yZSwgcGF5TG9hZCk7CiAgICAgIH07CiAgICB9KTsKICB9CgogIF9jcmVhdGVDbGFzcyhTdG9yZSwgW3sKICAgIGtleTogInN0YXRlIiwKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAvLyDnsbvnmoTlsZ7mgKforr/pl67lmagKICAgICAgcmV0dXJuIHRoaXMuX3N0YXRlLmRhdGE7CiAgICB9CiAgfSwgewogICAga2V5OiAiaW5zdGFsbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaW5zdGFsbChhcHAsIGluamVjdEtleSkgewogICAgICAvLyBjcmVhdGVBcHAoKS51c2Uoc3RvcmUsICdteScpCiAgICAgIC8vIOWFqOWxgOaatOmcsuS4gOS4quWPmOmHjyDmmrTpnLLnmoTmmK9zdG9yZeeahOWunuS+iwogICAgICBhcHAucHJvdmlkZShpbmplY3RLZXkgfHwgc3RvcmVLZXksIHRoaXMpOyAvLyDnu5not59hcHDlop7liqDkuIDkuKogX3Byb3ZpZGVzLOWtkOe7hOS7tuS8muWOu+WQkeS4iuafpeaJvgogICAgICAvLyB2dWUucHJvcGVydGllcy4kc3RvcmUgPSB0aGlzCgogICAgICBhcHAuY29uZmlnLmdsb2JhbFByb3BlcnRpZXMuJHN0b3JlID0gdGhpczsgLy8g5aKe5re7ICRzdG9yZQogICAgfQogIH1dKTsKCiAgcmV0dXJuIFN0b3JlOwp9KCk7CgpleHBvcnQgZnVuY3Rpb24gY3JlYXRlU3RvcmUob3B0aW9ucykgewogIHJldHVybiBuZXcgU3RvcmUob3B0aW9ucyk7Cn0gLy8gdnVl5YaF6YOo5bey57uP5bCG6L+Z5LqbYXBp5a+8c+WHuuadpeS6hgoKZXhwb3J0IGZ1bmN0aW9uIHVzZVN0b3JlKCkgewogIHZhciBpbmplY3RLZXkgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHN0b3JlS2V5OwogIHJldHVybiBpbmplY3QoaW5qZWN0S2V5ICE9PSBudWxsID8gaW5qZWN0S2V5IDogc3RvcmVLZXkpOwp9"},{"version":3,"sources":["/Users/xiaoma/Documents/gitlab/web/vuex-4-code/src/vuex/index.js"],"names":["inject","reactive","forEachValue","obj","fn","Object","keys","forEach","key","storeKey","Store","options","type","payLoad","_mutations","payload","_actions","console","log","store","_state","data","state","_getters","getters","defineProperty","get","create","mutations","actions","call","app","injectKey","provide","config","globalProperties","$store","createStore","useStore"],"mappings":"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","sourcesContent":["import { inject, reactive } from \"vue\"\n\nexport function forEachValue(obj, fn) {\n  Object.keys(obj).forEach(key => fn(obj[key], key));\n}\n// forEachValue({a:1,b:2},function(value, key){\n//     console.log(value, key)\n// })\n// 创建容器 返回一个store\nconst storeKey = \"store\"\nclass Store {\n  constructor(options) {\n    console.log(options)\n    // this.a =100; \n    // vue3 内部会创造一个vue实例，但vuex4直接会采用vue3提供的响应式方法\n    // this.state = options.state;\n    const store = this;\n    // store._store.data \n    store._state = reactive({ data: options.state }) // new Vue()\n    // vuex 中有个比较重要的API replaceState\n    const _getters = options.getters; // {double: function => getter}\n    store.getters = {};\n    forEachValue(_getters, function (fn, key) {\n      Object.defineProperty(store.getters, key, {\n        get: () => fn(store.state) // computed, 很遗憾，在vuex中vue3.1 不能用computed 实现 如果组件销毁了会移除计算属性，vue3.2会改掉这个bug\n\n      })\n    })\n    // mutation action {add:function} {asyncAdd: function}\n    // commit(\"add\") dispatch(\"asyncAdd\")\n    store._mutations = Object.create(null);\n    store._actions = Object.create(null);\n    const _mutations = options.mutations;\n    const _actions = options.actions;\n    forEachValue(_mutations, (mutations, key) => {\n      store._mutations[key] = (payLoad) => {\n        mutations.call(store, store.state, payLoad);\n      }\n    })\n    forEachValue(_actions, (actions, key) => { //\n      store._actions[key] = (payLoad) => {\n        actions.call(store, store, payLoad);\n      }\n    })\n  }\n  commit = (type, payLoad) => { // bindsss\n    this._mutations[type](payLoad);\n  }\n  dispatch = (type, payload) => {\n    this._actions[type](payload);\n  }\n  get state() { // 类的属性访问器\n    return this._state.data;\n  }\n  install(app, injectKey) { // createApp().use(store, 'my')\n    // 全局暴露一个变量 暴露的是store的实例\n    app.provide(injectKey || storeKey, this); // 给跟app增加一个 _provides,子组件会去向上查找\n    // vue.properties.$store = this\n    app.config.globalProperties.$store = this; // 增添 $store\n  }\n}\n\nexport function createStore(options) {\n  return new Store(options);\n\n}\n// vue内部已经将这些api导s出来了\nexport function useStore(injectKey = storeKey) {\n  return inject(injectKey !== null ? injectKey : storeKey)\n}"]}]}